from openai import OpenAI
import os
from pdf_segmentation import extract_paragraphs_from_pdf, extract_paragraphs_from_page

pdf_path = r"C:\Users\fabic\Downloads\TsengFERD21.pdf"
paragraphs = extract_paragraphs_from_pdf(pdf_path)


# Get the filename without the extension and the directory path
file_name = os.path.splitext(os.path.basename(pdf_path))[0]
output_path = os.path.join(os.path.dirname(pdf_path), file_name + ".txt")

client = OpenAI()

#clear file
with open(output_path, "w", encoding="utf-8") as output_file:
  output_file.write("")

with open(output_path, "a", encoding="utf-8") as output_file:
    for i, paragraph in enumerate(paragraphs):

        #This part uses openAI API to evaluate the paragraph

        #paragraph = "The goal of our study was to examine how the push to remote-only  interaction required by the COVID-19 pandemic impacted the delivery of computer security support to IPV survivors. To accomplish  this, we studied data from (1) real-world remote consults, and (2)  refective focus groups with the consultants who delivered them. Together, these data illuminate the dynamics of client-consultant  interactions during remote consults, as well as consultants’ refections on how remote service delivery compared to their experiences  with in-person consults. All study procedures were approved by  our institutional IRB. Refection, refexivity, and positionality. Given the nature of  our work, it is essential to disclose that each of the fve authors  of this paper volunteers in CETA, where they are members of a  larger team of 20+ people. Some of the authors’ experiences are  represented in our consult data, and all but one author participated  in at least one focus group (discussed below). As a result,some of our  personal biases and experiences are included in our fndings, and  thus our methods should be understood as refective and refexive  forms of qualitative research [62, 64]."


        completion = response = client.chat.completions.create(
          model="gpt-4",
          messages=[
            {"role": "system", "content": "You are being presented with a paragraph of an academic paper. Please check wheather one of the following criteria are fullfilled within the paragraph. Please list only those criteria that are found in the paragraphs in your and an examplary quote answer. The criteria list is  as follows: \n 01 ETHICS  The ethical considerations of the study design, execution, and results is discussed, potentially including their implications and mitigations. This ethics does not entail IRB approval; we have a different code for IRB approval.\n  - 02 IRB It is stated that it has IRB/ERB approval, or justified why that was not necessary/possible.??Should onlybe coded, when a board is mentioned (e.g., when 'complicance with university requirements' that is no IRB/ERB) \n - CONSENT It is specified if and how informed consent was obtained, or why it was not obtained (e.g., in the case of deception studies).??Should be coded with 'Does not apply' in the case when no ethics considerations are necessary. \n  - 04 CONSENT-FORM  The consent form (or any other materials for obtaining informed consent) is available.? \n  - 05 STUDY-COMPENSATION  It is stated if and how participants are compensated. \n  - 06 VULNERABILITY-DISCLOSURE  In the case of detected vulnerabilities, the handling and disclosure of vulnerabilities is discussed.  \n  - 07 ANON  Utilized methods of data anonymization/pseudonymization/de-identification are reported when PII are published. ??This code should only be coded in case of interview quotes or publishing data(sets), etc. Elsewise, this should be coded with 'Does not apply'  \n  - 08 RQ  The research questions or research goals are clearly stated.  \n  - 09 METHOD-CHOICE Its is stated what method(s) were chosen, and why.?  \n  - 10 LIMITATIONS-AND-VALIDITY-THREATS  Limitations and/or threats to validity are discussed.?  \n  - 11 PREREG  It is stated if the study was preregistered, and a reference to the preregistration is provided if one was done.??As in theory every study or its analysis might be pre-registered, cannot be coded with 'Does not apply', use 'Unavailable' in those cases.  \n  - 12 POSITIONALITY A statement on the authors positionality in relation to the research is available.  \n  - 13 CONFLICTS-OF-INTEREST-AND-FUNDING Conflicts of interests, or lack thereof, are declared. This also includes acknowledging funding.  \n  - 14 AUTHOR-CONTACT-INFORMATION  Contact information for at least one author is provided (e.g., email address, postal address, or ORCiD with an email address). Name and institution are not sufficient contact information, as they alone do not allow to establish contact.  \n  - 15 EXPERIMENT-MATERIALS  The materials used during the experiment (e.g. task descriptions, information texts etc.) are available.??In some cases we might find screenshots or other descriptions of an experiment system. If those were not screenshots in the original experiment (but a website for example), we code 'partially available'. \n  - 16 SURVEY  The survey's questions are available.?This code is about the actual questions, not any summary of what these questions were.  \n  - 17 INTERVIEW-GUIDE The interview guide is available.?This code is about the actual questions, not any summary of what these questions were.  \n  - 18 STUDY-PROTOCOL  The study protocol, i.e. a description of all steps and their order, is available.  \n  - 19 STUDY-PILOTING  Piloting of the study and its results are described.  \n  - 20 STUDY-DURATION  Information on the duration of the study is available, e.g., how long filling the survey took, how long interviews were, or the duration of an experiment.??This code is not about how long analysis took.  \n  - 21 STUDY-CONTEXT The context of the study, i.e. when (e.g., year/month), in what setting (e.g., in a lab or online), and under which conditions it was conducted, is described.  \n  - 22 SAMPLED-POPULATION  The population that is studied is described.  \n  - 23 SAMPLE-DESCRIPTION  The characteristics of the sample are described (e.g., demographics).  \n  - 24 SAMPLING-PROCEDURE  The sampling/recruitment procedure or method, including inclusion and exclusion criteria, is described.  \n  - 25 SAMPLING-MATERIALS  The sampling/recruitment materials (e.g. recruitment texts, sampling scripts) are provided.  \n  - 26 SAMPLING-SUCCESS-RATE The sampling/recruitment success ratio (valid data points vs. e.g. drop-outs, no-shows, time-outs) is discussed.??If a rate is not computable (e.g. distirbuting flyers and not knowing how many people got flyers), should be coded with 'Does not apply'.  \n  - 27 SAMPLE-SIZE The sample size is stated.  \n  - 28 SAMPLE-SIZE-JUSTIFICATION A justification for the sample size (e.g. saturation, power-analysis) is provided.  \n  - 29 CONDITION-ASSIGNMENT  How participants were assigned to conditions is explained. (E.g., what conditions/groups, whether participant assignment was random)  \n  - 30 DATA-PREPROCESSING  Any data processing steps before the actual data analysis are described. This includes transcription, data cleaning (e.g. outlier treatment, missing datapoint treatment), etc.  \n  - 31 SHARE-DATA  The primary (de-identified) data set is available.  \n  - 32 SHARE-SOFTWARE  The source code or specification of any software used in the study protocol (e.g. analyzed prototypes) is provided.??This does not include any code for data analysis (we have a seperate code for this). We also do not code any statements of survey software that was used (e.g., Qualtrics) as this is already covered by the 'SURVEY' code.  \n  - 33 SHARE-HARDWARE  The specification of any hardware used in the study protocol is provided.  \n  - 34 QUAL-ANALYSIS-METHOD  The specific qualitative analysis method/approach is named and referenced, or described.  \n  - 35 QUAL-ANALYSIS-CODEBOOK  The codebook is available.  \n  - 36 QUAL-ANALYSIS-RELIABILITY Inter-Rater-Reliability or other Trust-Measures are stated, or their inapplicability is discussed.  \n  - 37 QUAL-EMPIRICAL-EVIDENCE Empirical evidence (e.g. quotes, field notes, excerpts, photographs) is provided to support results.  \n  - 38 DATA-ANALYSIS-SOFTWARE  (Self-written) code or specifications of third-party software used for data analysis are provided.??Also covers things like what statistics software, what QDA software, etc.  \n  - 39 QUANT-ANALYSIS-METHOD The specific quantitative analysis method/approach is named and referenced, or described.  \n  - 40 QUANT-VARIABLES All variables that are considered in the statistical analysis are named and defined.  \n  - 41 QUANT-VARIABLE-DEPENDENCIES All variables are either labeled as independent or their dependencies to other variables are stated.  \n  - 42 QUANT-HYPOTHESES  All tested hypotheses are explicitly stated.  \n  - 43 QUANT-DESCRIPTIVE (central tendeny) The central tendency of the sample on interval or ratio scales is reported per dependent variable.  \n  - 44 QUANT-DESCRIPTIVE (variability) The variability of the sample on interval or ratio scales is reported per dependent variable.  \n  - 45 QUANT-DESCRIPTIVE (categorical data)  The value of the sample on nominal or ordinal scales is reported per dependent variable.  \n  - 46 QUANT-ASSUMPTIONS Required statistical assumptions are discussed per test/method and how they fit the data (consider only when statistical tests/models are used, elsewise 'Does not apply').  \n  - 47 QUANT-PARAMETERS (df) Degrees of freedom (DoF) are reported where applicable.  \n  - 48 QUANT-PARAMETERS (test value) For statistical tests, are the applicable parameters reported.  \n  - 49 QUANT-PARAMETERS (p-value)  For statistical tests that output p-values, the p-values were reported.??TODO Overlaps with test value and significant/insignificant codes  \n  - 50 QUANT-EFFECT-SIZE For statistical effects the effect-size is reported.  \n  - 51 QUANT-CI  Confidence intervals (CIs) of staistical outcomes were reported where applicable.  \n  - 52 QUANT-SIGNIFICANT-INSIGNIFICANT For the applied statistical methods, all results including non-significant results are reported.?"},
            {"role": "user", "content": paragraph}
          ]
        )
        output = completion.choices[0].message
        output_file.write(str(output) + "\n \n")






